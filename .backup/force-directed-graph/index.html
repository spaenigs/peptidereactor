<!DOCTYPE html>
<meta charset="utf-8">
<script src="https://d3js.org/d3.v5.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/webcola@3.4.0/WebCola/cola.min.js"></script>
<body>
<svg id='viz'></svg>
</body>
<script>

    const scale = d3.scaleOrdinal(d3.schemeSet3.concat(d3.schemeCategory10).concat(d3.schemeSet1)),
          shape = d3.scaleOrdinal(d3.symbols),
          width = 1024,
          height = 768;

    d3.json("../00_data/out/neuropeptides/neuropeptides_ds1/analyis/t_test/classes/neuropeptides_ds1_normalized-yes_ttest_all.json")
    // d3.json("../00_data/out/neuropeptides/neuropeptides_ds1/analyis/t_test/scores/neuropeptides_ds1_normalized-yes_ttest_all.json")
    // d3.json("../00_data/out/neuropeptides/neuropeptides_ds1/analyis/t_test/aucs/neuropeptides_ds1_normalized-yes_ttest_all.json")
        .then(function(data) {

            const nodes = data.nodes.map(d => Object.create(d));
            const index = new Map(nodes.map(d => [d.id, d]));
            const links = data.links.map(d => Object.assign(Object.create(d), {
                source: index.get(d.source),
                target: index.get(d.target)
            }));

            const layout = cola.d3adaptor(d3)
                .size([width, height])
                .nodes(nodes)
                .links(links)
                .jaccardLinkLengths(40, 0.7)
                .start(100);

            const svg = d3.select("#viz").attr("width", width).attr("height", height);

            const link = svg.append("g")
                .attr("stroke", "#999")
                .selectAll("line")
                .data(links)
                .join("line")
                    .attr("stroke", d => d.pvalue <= 0.05 ? "#999" : "#fff")
                    .attr("stroke-width", d => d.pvalue <= 0.05 ? 1 : 0.001);

            link.append("title")
                .text(d => d.pvalue);

            const node = svg.append("g")
                .attr("stroke", "#fff")
                .attr("stroke-width", 1.5)
                .selectAll("path")
                .data(nodes)
                .join("path")
                    .attr("fill", function(d) { return scale(d.group); })
                    .attr("d", d3.symbol().type( function(d) {
                        // return shape(d.group);
                        return d3.symbolCircle;
                    }))
                .call(layout.drag);

            node.append("title")
                .text(d => d.id);

            const headline = svg.selectAll(".headline")
                .data(["t-test model-wise (1-classification error)"])
                // .data(["t-test sample-wise (1-score)"])
                // .data(["t-test model-wise (AUC)"])
                .enter()
                    .append("g")
                    .attr("class", "headline")
                    .attr("transform", function(d, i) { return "translate(0," + i * 20 + ")"; });

            headline.append("text")
                .attr("x", 350)
                .attr("y", 9)
                .attr("dy", ".35em")
                .style("text-anchor", "end")
                .text(function(d) { return d; });

            const legend = svg.selectAll(".legend")
                // .data(scale.domain())
                .data(["(*)"])
                .enter()
                    .append("g")
                    .attr("class", "legend")
                    .attr("transform", function(d, i) { return "translate(0," + i * 20 + ")"; });

            legend.append("line")
                .attr("x1", 5 + (width - 200))
                .attr("y1", 9)
                .attr("x2", 10 + (width - 70))
                .attr("y2", 9)
                .attr("stroke", "black");

            legend.append("text")
                .attr("x", width - 24)
                .attr("y", 9)
                .attr("dy", ".35em")
                .style("text-anchor", "end")
                .text(function(d) { return d; });

            layout.on("tick", () => {
                link
                    .attr("x1", d => d.source.x)
                    .attr("y1", d => d.source.y)
                    .attr("x2", d => d.target.x)
                    .attr("y2", d => d.target.y);
                node
                    .attr('transform', function(d) { return 'translate('+d.x+','+d.y+')'; });
            });

            return svg.node();

    });

</script>