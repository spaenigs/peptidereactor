from glob import glob

import os

TOKEN = config["token"]
CSVS_IN = []
for csv_dir in config["csv_in"]:
    for p in glob(csv_dir + "*.csv"):
        CSVS_IN += [p]
CSV_DIR = os.path.commonpath(config["csv_in"])
NAMES = [p.replace(CSV_DIR, "").replace(".csv", "") for p in CSVS_IN]

rule all:
    input:
         expand(config["cv_dir_out"] + f"y_true_cv_{{name}}.csv", name=NAMES),
         expand(config["cv_dir_out"] + f"y_pred_cv_{{name}}.csv", name=NAMES),
         expand(config["cv_dir_out"] + f"y_prob_cv_{{name}}.csv", name=NAMES)

rule train:
    input:
         f"{CSV_DIR}{{name}}.csv"
    output:
         config["cv_dir_out"] + f"y_true_cv_{{name}}.csv",
         config["cv_dir_out"] + f"y_pred_cv_{{name}}.csv",
         config["cv_dir_out"] + f"y_prob_cv_{{name}}.csv"
    script:
         "../scripts/cv.py"

 # for i in range(50):
 #     y_pred = df.iloc[i, :190].dropna()
 #     y_true = df.iloc[i, 190:].dropna()
 #     print((len(y_pred), len(y_true)))
 #     print(matthews_corrcoef(y_true, y_pred))